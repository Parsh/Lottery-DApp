d9e7750b2f5ee62b426c23cf6ecb48f2
const ganache = require('ganache-cli');
const Web3 = require('web3');
const web3 = new Web3(ganache.provider());
const compiledContract = require('../compile');

describe('Lottery Contract', () => {
  beforeEach(async () => {
    accounts = await web3.eth.getAccounts();
    lottery = await new web3.eth.Contract(JSON.parse(compiledContract.interface)).deploy({
      data: compiledContract.bytecode
    }).send({
      from: accounts[0],
      gas: '1000000'
    });
  });

  it('should deploy the contract', () => {
    expect(lottery.options.address).toBeDefined();
  });

  it('should allow an account to enter the lottery', async () => {
    await lottery.methods.enter().send({
      from: accounts[0],
      value: web3.utils.toWei('0.1', 'ether')
    });

    const players = await lottery.methods.getPlayers().call({
      from: accounts[0]
    });

    expect(players[0]).toEqual(accounts[0]);
    expect(players.length).toBe(1);
  });

  it('should allow multiple accounts to enter the lottery', async () => {
    await lottery.methods.enter().send({
      from: accounts[0],
      value: web3.utils.toWei('0.1', 'ether')
    });

    await lottery.methods.enter().send({
      from: accounts[1],
      value: web3.utils.toWei('0.1', 'ether')
    });

    await lottery.methods.enter().send({
      from: accounts[2],
      value: web3.utils.toWei('0.1', 'ether')
    });

    const players = await lottery.methods.getPlayers().call({
      from: accounts[0]
    });

    expect(players[0]).toEqual(accounts[0]);
    expect(players[1]).toEqual(accounts[1]);
    expect(players[2]).toEqual(accounts[2]);
    expect(players.length).toBe(3);
  });

  it('should require a minimum amount of ether to enter', async () => {
    try {
      await lottery.methods.enter().send({
        from: accounts[0],
        value: '200'
      });

      fail(); //executes and fails the test if the above await didn't throw an error
    } catch (err) {
      expect(err).toBeDefined();
    }
  });

  it('should only allow the manager to call pickWinner ', async () => {
    try {
      await lotter.methods.pickWinner().send({
        from: accounts[1]
      });
      fail();
    } catch (err) {
      expect(err).toBeDefined();
    }
  });

  it('should send all the money to the (single) winner and reset the players array', async () => {
    await lottery.methods.enter().send({
      from: accounts[1],
      value: web3.utils.toWei('2', 'ether')
    });

    const currentBal = await web3.eth.getBalance(accounts[1]);

    lotteryBalance = await web3.eth.getBalance(lottery.options.address);
    expect(parseInt(lotteryBalance)).toEqual(parseInt(web3.utils.toWei('2', 'ether')));

    await lottery.methods.pickWinner().send({
      from: accounts[0]
    });
    const finalBal = await web3.eth.getBalance(accounts[1]);
    const diff = finalBal - currentBal;

    expect(diff).toEqual(parseInt(web3.utils.toWei('2', 'ether')));

    const players = await lottery.methods.getPlayers().call({
      from: accounts[0]
    });
    expect(players.length).toBe(0);

    lotteryBalance = await web3.eth.getBalance(lottery.options.address);
    expect(parseInt(lotteryBalance)).toEqual(0);
  });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkxvdHRlcnkudGVzdC5qcyJdLCJuYW1lcyI6WyJnYW5hY2hlIiwicmVxdWlyZSIsIldlYjMiLCJ3ZWIzIiwicHJvdmlkZXIiLCJjb21waWxlZENvbnRyYWN0IiwiZGVzY3JpYmUiLCJiZWZvcmVFYWNoIiwiYWNjb3VudHMiLCJldGgiLCJnZXRBY2NvdW50cyIsImxvdHRlcnkiLCJDb250cmFjdCIsIkpTT04iLCJwYXJzZSIsImludGVyZmFjZSIsImRlcGxveSIsImRhdGEiLCJieXRlY29kZSIsInNlbmQiLCJmcm9tIiwiZ2FzIiwiaXQiLCJleHBlY3QiLCJvcHRpb25zIiwiYWRkcmVzcyIsInRvQmVEZWZpbmVkIiwibWV0aG9kcyIsImVudGVyIiwidmFsdWUiLCJ1dGlscyIsInRvV2VpIiwicGxheWVycyIsImdldFBsYXllcnMiLCJjYWxsIiwidG9FcXVhbCIsImxlbmd0aCIsInRvQmUiLCJmYWlsIiwiZXJyIiwibG90dGVyIiwicGlja1dpbm5lciIsImN1cnJlbnRCYWwiLCJnZXRCYWxhbmNlIiwibG90dGVyeUJhbGFuY2UiLCJwYXJzZUludCIsImZpbmFsQmFsIiwiZGlmZiJdLCJtYXBwaW5ncyI6IkFBQUEsTUFBTUEsVUFBVUMsUUFBUSxhQUFSLENBQWhCO0FBQ0EsTUFBTUMsT0FBT0QsUUFBUSxNQUFSLENBQWI7QUFDQSxNQUFNRSxPQUFPLElBQUlELElBQUosQ0FBU0YsUUFBUUksUUFBUixFQUFULENBQWI7QUFDQSxNQUFNQyxtQkFBbUJKLFFBQVEsWUFBUixDQUF6Qjs7QUFFQUssU0FBUyxrQkFBVCxFQUE2QixNQUFNO0FBQ2pDQyxhQUFXLFlBQVk7QUFDckJDLGVBQVcsTUFBTUwsS0FBS00sR0FBTCxDQUFTQyxXQUFULEVBQWpCO0FBQ0FDLGNBQVUsTUFBTSxJQUFJUixLQUFLTSxHQUFMLENBQVNHLFFBQWIsQ0FDZEMsS0FBS0MsS0FBTCxDQUFXVCxpQkFBaUJVLFNBQTVCLENBRGMsRUFHYkMsTUFIYSxDQUdOO0FBQ05DLFlBQU1aLGlCQUFpQmE7QUFEakIsS0FITSxFQU1iQyxJQU5hLENBTVI7QUFDSkMsWUFBTVosU0FBUyxDQUFULENBREY7QUFFSmEsV0FBSztBQUZELEtBTlEsQ0FBaEI7QUFVRCxHQVpEOztBQWNBQyxLQUFHLDRCQUFILEVBQWlDLE1BQU07QUFDckNDLFdBQU9aLFFBQVFhLE9BQVIsQ0FBZ0JDLE9BQXZCLEVBQWdDQyxXQUFoQztBQUNELEdBRkQ7O0FBSUFKLEtBQUcsOENBQUgsRUFBbUQsWUFBWTtBQUM3RCxVQUFNWCxRQUFRZ0IsT0FBUixDQUFnQkMsS0FBaEIsR0FBd0JULElBQXhCLENBQTZCO0FBQ2pDQyxZQUFNWixTQUFTLENBQVQsQ0FEMkI7QUFFakNxQixhQUFPMUIsS0FBSzJCLEtBQUwsQ0FBV0MsS0FBWCxDQUFpQixLQUFqQixFQUF3QixPQUF4QjtBQUYwQixLQUE3QixDQUFOOztBQUtBLFVBQU1DLFVBQVUsTUFBTXJCLFFBQVFnQixPQUFSLENBQWdCTSxVQUFoQixHQUE2QkMsSUFBN0IsQ0FBa0M7QUFDdERkLFlBQU1aLFNBQVMsQ0FBVDtBQURnRCxLQUFsQyxDQUF0Qjs7QUFJQWUsV0FBT1MsUUFBUSxDQUFSLENBQVAsRUFBbUJHLE9BQW5CLENBQTJCM0IsU0FBUyxDQUFULENBQTNCO0FBQ0FlLFdBQU9TLFFBQVFJLE1BQWYsRUFBdUJDLElBQXZCLENBQTRCLENBQTVCO0FBQ0QsR0FaRDs7QUFjQWYsS0FBRyxxREFBSCxFQUEwRCxZQUFZO0FBQ3BFLFVBQU1YLFFBQVFnQixPQUFSLENBQWdCQyxLQUFoQixHQUF3QlQsSUFBeEIsQ0FBNkI7QUFDakNDLFlBQU1aLFNBQVMsQ0FBVCxDQUQyQjtBQUVqQ3FCLGFBQU8xQixLQUFLMkIsS0FBTCxDQUFXQyxLQUFYLENBQWlCLEtBQWpCLEVBQXdCLE9BQXhCO0FBRjBCLEtBQTdCLENBQU47O0FBS0EsVUFBTXBCLFFBQVFnQixPQUFSLENBQWdCQyxLQUFoQixHQUF3QlQsSUFBeEIsQ0FBNkI7QUFDakNDLFlBQU1aLFNBQVMsQ0FBVCxDQUQyQjtBQUVqQ3FCLGFBQU8xQixLQUFLMkIsS0FBTCxDQUFXQyxLQUFYLENBQWlCLEtBQWpCLEVBQXdCLE9BQXhCO0FBRjBCLEtBQTdCLENBQU47O0FBS0EsVUFBTXBCLFFBQVFnQixPQUFSLENBQWdCQyxLQUFoQixHQUF3QlQsSUFBeEIsQ0FBNkI7QUFDakNDLFlBQU1aLFNBQVMsQ0FBVCxDQUQyQjtBQUVqQ3FCLGFBQU8xQixLQUFLMkIsS0FBTCxDQUFXQyxLQUFYLENBQWlCLEtBQWpCLEVBQXdCLE9BQXhCO0FBRjBCLEtBQTdCLENBQU47O0FBS0EsVUFBTUMsVUFBVSxNQUFNckIsUUFBUWdCLE9BQVIsQ0FBZ0JNLFVBQWhCLEdBQTZCQyxJQUE3QixDQUFrQztBQUN0RGQsWUFBTVosU0FBUyxDQUFUO0FBRGdELEtBQWxDLENBQXRCOztBQUlBZSxXQUFPUyxRQUFRLENBQVIsQ0FBUCxFQUFtQkcsT0FBbkIsQ0FBMkIzQixTQUFTLENBQVQsQ0FBM0I7QUFDQWUsV0FBT1MsUUFBUSxDQUFSLENBQVAsRUFBbUJHLE9BQW5CLENBQTJCM0IsU0FBUyxDQUFULENBQTNCO0FBQ0FlLFdBQU9TLFFBQVEsQ0FBUixDQUFQLEVBQW1CRyxPQUFuQixDQUEyQjNCLFNBQVMsQ0FBVCxDQUEzQjtBQUNBZSxXQUFPUyxRQUFRSSxNQUFmLEVBQXVCQyxJQUF2QixDQUE0QixDQUE1QjtBQUNELEdBeEJEOztBQTBCQWYsS0FBRyxtREFBSCxFQUF3RCxZQUFZO0FBQ2xFLFFBQUk7QUFDRixZQUFNWCxRQUFRZ0IsT0FBUixDQUFnQkMsS0FBaEIsR0FBd0JULElBQXhCLENBQTZCO0FBQ2pDQyxjQUFNWixTQUFTLENBQVQsQ0FEMkI7QUFFakNxQixlQUFPO0FBRjBCLE9BQTdCLENBQU47O0FBS0FTLGFBTkUsQ0FNTTtBQUNULEtBUEQsQ0FPRSxPQUFPQyxHQUFQLEVBQVk7QUFDWmhCLGFBQU9nQixHQUFQLEVBQVliLFdBQVo7QUFDRDtBQUNGLEdBWEQ7O0FBYUFKLEtBQUcsbURBQUgsRUFBd0QsWUFBWTtBQUNsRSxRQUFJO0FBQ0YsWUFBTWtCLE9BQU9iLE9BQVAsQ0FBZWMsVUFBZixHQUE0QnRCLElBQTVCLENBQWlDO0FBQ3JDQyxjQUFNWixTQUFTLENBQVQ7QUFEK0IsT0FBakMsQ0FBTjtBQUdBOEI7QUFDRCxLQUxELENBS0UsT0FBT0MsR0FBUCxFQUFZO0FBQ1poQixhQUFPZ0IsR0FBUCxFQUFZYixXQUFaO0FBQ0Q7QUFDRixHQVREOztBQVdBSixLQUFHLDhFQUFILEVBQW1GLFlBQVk7QUFDN0YsVUFBTVgsUUFBUWdCLE9BQVIsQ0FBZ0JDLEtBQWhCLEdBQXdCVCxJQUF4QixDQUE2QjtBQUNqQ0MsWUFBTVosU0FBUyxDQUFULENBRDJCO0FBRWpDcUIsYUFBTzFCLEtBQUsyQixLQUFMLENBQVdDLEtBQVgsQ0FBaUIsR0FBakIsRUFBc0IsT0FBdEI7QUFGMEIsS0FBN0IsQ0FBTjs7QUFLQSxVQUFNVyxhQUFhLE1BQU12QyxLQUFLTSxHQUFMLENBQVNrQyxVQUFULENBQW9CbkMsU0FBUyxDQUFULENBQXBCLENBQXpCOztBQUVBb0MscUJBQWlCLE1BQU16QyxLQUFLTSxHQUFMLENBQVNrQyxVQUFULENBQW9CaEMsUUFBUWEsT0FBUixDQUFnQkMsT0FBcEMsQ0FBdkI7QUFDQUYsV0FBT3NCLFNBQVNELGNBQVQsQ0FBUCxFQUFpQ1QsT0FBakMsQ0FDRVUsU0FBUzFDLEtBQUsyQixLQUFMLENBQVdDLEtBQVgsQ0FBaUIsR0FBakIsRUFBc0IsT0FBdEIsQ0FBVCxDQURGOztBQUlBLFVBQU1wQixRQUFRZ0IsT0FBUixDQUFnQmMsVUFBaEIsR0FBNkJ0QixJQUE3QixDQUFrQztBQUN0Q0MsWUFBTVosU0FBUyxDQUFUO0FBRGdDLEtBQWxDLENBQU47QUFHQSxVQUFNc0MsV0FBVyxNQUFNM0MsS0FBS00sR0FBTCxDQUFTa0MsVUFBVCxDQUFvQm5DLFNBQVMsQ0FBVCxDQUFwQixDQUF2QjtBQUNBLFVBQU11QyxPQUFPRCxXQUFXSixVQUF4Qjs7QUFFQW5CLFdBQU93QixJQUFQLEVBQWFaLE9BQWIsQ0FBcUJVLFNBQVMxQyxLQUFLMkIsS0FBTCxDQUFXQyxLQUFYLENBQWlCLEdBQWpCLEVBQXNCLE9BQXRCLENBQVQsQ0FBckI7O0FBRUEsVUFBTUMsVUFBVSxNQUFNckIsUUFBUWdCLE9BQVIsQ0FBZ0JNLFVBQWhCLEdBQTZCQyxJQUE3QixDQUFrQztBQUN0RGQsWUFBTVosU0FBUyxDQUFUO0FBRGdELEtBQWxDLENBQXRCO0FBR0FlLFdBQU9TLFFBQVFJLE1BQWYsRUFBdUJDLElBQXZCLENBQTRCLENBQTVCOztBQUVBTyxxQkFBaUIsTUFBTXpDLEtBQUtNLEdBQUwsQ0FBU2tDLFVBQVQsQ0FBb0JoQyxRQUFRYSxPQUFSLENBQWdCQyxPQUFwQyxDQUF2QjtBQUNBRixXQUFPc0IsU0FBU0QsY0FBVCxDQUFQLEVBQWlDVCxPQUFqQyxDQUF5QyxDQUF6QztBQUNELEdBNUJEO0FBNkJELENBaEhEIiwiZmlsZSI6IkxvdHRlcnkudGVzdC5qcyIsInNvdXJjZXNDb250ZW50IjpbImNvbnN0IGdhbmFjaGUgPSByZXF1aXJlKCdnYW5hY2hlLWNsaScpO1xuY29uc3QgV2ViMyA9IHJlcXVpcmUoJ3dlYjMnKTtcbmNvbnN0IHdlYjMgPSBuZXcgV2ViMyhnYW5hY2hlLnByb3ZpZGVyKCkpO1xuY29uc3QgY29tcGlsZWRDb250cmFjdCA9IHJlcXVpcmUoJy4uL2NvbXBpbGUnKTtcblxuZGVzY3JpYmUoJ0xvdHRlcnkgQ29udHJhY3QnLCAoKSA9PiB7XG4gIGJlZm9yZUVhY2goYXN5bmMgKCkgPT4ge1xuICAgIGFjY291bnRzID0gYXdhaXQgd2ViMy5ldGguZ2V0QWNjb3VudHMoKTtcbiAgICBsb3R0ZXJ5ID0gYXdhaXQgbmV3IHdlYjMuZXRoLkNvbnRyYWN0KFxuICAgICAgSlNPTi5wYXJzZShjb21waWxlZENvbnRyYWN0LmludGVyZmFjZSlcbiAgICApXG4gICAgICAuZGVwbG95KHtcbiAgICAgICAgZGF0YTogY29tcGlsZWRDb250cmFjdC5ieXRlY29kZVxuICAgICAgfSlcbiAgICAgIC5zZW5kKHtcbiAgICAgICAgZnJvbTogYWNjb3VudHNbMF0sXG4gICAgICAgIGdhczogJzEwMDAwMDAnXG4gICAgICB9KTtcbiAgfSk7XG5cbiAgaXQoJ3Nob3VsZCBkZXBsb3kgdGhlIGNvbnRyYWN0JywgKCkgPT4ge1xuICAgIGV4cGVjdChsb3R0ZXJ5Lm9wdGlvbnMuYWRkcmVzcykudG9CZURlZmluZWQoKTtcbiAgfSk7XG5cbiAgaXQoJ3Nob3VsZCBhbGxvdyBhbiBhY2NvdW50IHRvIGVudGVyIHRoZSBsb3R0ZXJ5JywgYXN5bmMgKCkgPT4ge1xuICAgIGF3YWl0IGxvdHRlcnkubWV0aG9kcy5lbnRlcigpLnNlbmQoe1xuICAgICAgZnJvbTogYWNjb3VudHNbMF0sXG4gICAgICB2YWx1ZTogd2ViMy51dGlscy50b1dlaSgnMC4xJywgJ2V0aGVyJylcbiAgICB9KTtcblxuICAgIGNvbnN0IHBsYXllcnMgPSBhd2FpdCBsb3R0ZXJ5Lm1ldGhvZHMuZ2V0UGxheWVycygpLmNhbGwoe1xuICAgICAgZnJvbTogYWNjb3VudHNbMF1cbiAgICB9KTtcblxuICAgIGV4cGVjdChwbGF5ZXJzWzBdKS50b0VxdWFsKGFjY291bnRzWzBdKTtcbiAgICBleHBlY3QocGxheWVycy5sZW5ndGgpLnRvQmUoMSk7XG4gIH0pO1xuXG4gIGl0KCdzaG91bGQgYWxsb3cgbXVsdGlwbGUgYWNjb3VudHMgdG8gZW50ZXIgdGhlIGxvdHRlcnknLCBhc3luYyAoKSA9PiB7XG4gICAgYXdhaXQgbG90dGVyeS5tZXRob2RzLmVudGVyKCkuc2VuZCh7XG4gICAgICBmcm9tOiBhY2NvdW50c1swXSxcbiAgICAgIHZhbHVlOiB3ZWIzLnV0aWxzLnRvV2VpKCcwLjEnLCAnZXRoZXInKVxuICAgIH0pO1xuXG4gICAgYXdhaXQgbG90dGVyeS5tZXRob2RzLmVudGVyKCkuc2VuZCh7XG4gICAgICBmcm9tOiBhY2NvdW50c1sxXSxcbiAgICAgIHZhbHVlOiB3ZWIzLnV0aWxzLnRvV2VpKCcwLjEnLCAnZXRoZXInKVxuICAgIH0pO1xuXG4gICAgYXdhaXQgbG90dGVyeS5tZXRob2RzLmVudGVyKCkuc2VuZCh7XG4gICAgICBmcm9tOiBhY2NvdW50c1syXSxcbiAgICAgIHZhbHVlOiB3ZWIzLnV0aWxzLnRvV2VpKCcwLjEnLCAnZXRoZXInKVxuICAgIH0pO1xuXG4gICAgY29uc3QgcGxheWVycyA9IGF3YWl0IGxvdHRlcnkubWV0aG9kcy5nZXRQbGF5ZXJzKCkuY2FsbCh7XG4gICAgICBmcm9tOiBhY2NvdW50c1swXVxuICAgIH0pO1xuXG4gICAgZXhwZWN0KHBsYXllcnNbMF0pLnRvRXF1YWwoYWNjb3VudHNbMF0pO1xuICAgIGV4cGVjdChwbGF5ZXJzWzFdKS50b0VxdWFsKGFjY291bnRzWzFdKTtcbiAgICBleHBlY3QocGxheWVyc1syXSkudG9FcXVhbChhY2NvdW50c1syXSk7XG4gICAgZXhwZWN0KHBsYXllcnMubGVuZ3RoKS50b0JlKDMpO1xuICB9KTtcblxuICBpdCgnc2hvdWxkIHJlcXVpcmUgYSBtaW5pbXVtIGFtb3VudCBvZiBldGhlciB0byBlbnRlcicsIGFzeW5jICgpID0+IHtcbiAgICB0cnkge1xuICAgICAgYXdhaXQgbG90dGVyeS5tZXRob2RzLmVudGVyKCkuc2VuZCh7XG4gICAgICAgIGZyb206IGFjY291bnRzWzBdLFxuICAgICAgICB2YWx1ZTogJzIwMCdcbiAgICAgIH0pO1xuXG4gICAgICBmYWlsKCk7IC8vZXhlY3V0ZXMgYW5kIGZhaWxzIHRoZSB0ZXN0IGlmIHRoZSBhYm92ZSBhd2FpdCBkaWRuJ3QgdGhyb3cgYW4gZXJyb3JcbiAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgIGV4cGVjdChlcnIpLnRvQmVEZWZpbmVkKCk7XG4gICAgfVxuICB9KTtcblxuICBpdCgnc2hvdWxkIG9ubHkgYWxsb3cgdGhlIG1hbmFnZXIgdG8gY2FsbCBwaWNrV2lubmVyICcsIGFzeW5jICgpID0+IHtcbiAgICB0cnkge1xuICAgICAgYXdhaXQgbG90dGVyLm1ldGhvZHMucGlja1dpbm5lcigpLnNlbmQoe1xuICAgICAgICBmcm9tOiBhY2NvdW50c1sxXVxuICAgICAgfSk7XG4gICAgICBmYWlsKCk7XG4gICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICBleHBlY3QoZXJyKS50b0JlRGVmaW5lZCgpO1xuICAgIH1cbiAgfSk7XG5cbiAgaXQoJ3Nob3VsZCBzZW5kIGFsbCB0aGUgbW9uZXkgdG8gdGhlIChzaW5nbGUpIHdpbm5lciBhbmQgcmVzZXQgdGhlIHBsYXllcnMgYXJyYXknLCBhc3luYyAoKSA9PiB7XG4gICAgYXdhaXQgbG90dGVyeS5tZXRob2RzLmVudGVyKCkuc2VuZCh7XG4gICAgICBmcm9tOiBhY2NvdW50c1sxXSxcbiAgICAgIHZhbHVlOiB3ZWIzLnV0aWxzLnRvV2VpKCcyJywgJ2V0aGVyJylcbiAgICB9KTtcblxuICAgIGNvbnN0IGN1cnJlbnRCYWwgPSBhd2FpdCB3ZWIzLmV0aC5nZXRCYWxhbmNlKGFjY291bnRzWzFdKTtcblxuICAgIGxvdHRlcnlCYWxhbmNlID0gYXdhaXQgd2ViMy5ldGguZ2V0QmFsYW5jZShsb3R0ZXJ5Lm9wdGlvbnMuYWRkcmVzcyk7XG4gICAgZXhwZWN0KHBhcnNlSW50KGxvdHRlcnlCYWxhbmNlKSkudG9FcXVhbChcbiAgICAgIHBhcnNlSW50KHdlYjMudXRpbHMudG9XZWkoJzInLCAnZXRoZXInKSlcbiAgICApO1xuXG4gICAgYXdhaXQgbG90dGVyeS5tZXRob2RzLnBpY2tXaW5uZXIoKS5zZW5kKHtcbiAgICAgIGZyb206IGFjY291bnRzWzBdXG4gICAgfSk7XG4gICAgY29uc3QgZmluYWxCYWwgPSBhd2FpdCB3ZWIzLmV0aC5nZXRCYWxhbmNlKGFjY291bnRzWzFdKTtcbiAgICBjb25zdCBkaWZmID0gZmluYWxCYWwgLSBjdXJyZW50QmFsO1xuXG4gICAgZXhwZWN0KGRpZmYpLnRvRXF1YWwocGFyc2VJbnQod2ViMy51dGlscy50b1dlaSgnMicsICdldGhlcicpKSk7XG5cbiAgICBjb25zdCBwbGF5ZXJzID0gYXdhaXQgbG90dGVyeS5tZXRob2RzLmdldFBsYXllcnMoKS5jYWxsKHtcbiAgICAgIGZyb206IGFjY291bnRzWzBdXG4gICAgfSk7XG4gICAgZXhwZWN0KHBsYXllcnMubGVuZ3RoKS50b0JlKDApO1xuXG4gICAgbG90dGVyeUJhbGFuY2UgPSBhd2FpdCB3ZWIzLmV0aC5nZXRCYWxhbmNlKGxvdHRlcnkub3B0aW9ucy5hZGRyZXNzKTtcbiAgICBleHBlY3QocGFyc2VJbnQobG90dGVyeUJhbGFuY2UpKS50b0VxdWFsKDApO1xuICB9KTtcbn0pO1xuIl19